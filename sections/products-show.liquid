{% schema %}
{
  "name": "Products Show",
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "Select Collection"
    },
    {
      "type": "checkbox",
      "id": "enable_cta",
      "label": "Enable CTA Buttons",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Products Show",
      "category": "Products"
    }
  ]
}
{% endschema %}




{% if section.settings.collection.products_count > 0 %}
  <div class="featured-collection">
    {% for product in section.settings.collection.products %}
      <div class="product-card">
        <div class="product-image-container">
          <img src="{{ product.featured_image | img_url: '300x300' }}" 
               alt="{{ product.title }}" 
               data-focal-x="{{ product.featured_image.aspect_ratio | times: 50 }}"
               data-focal-y="50">
          {{ product.featured_image.presentation.focal_point }}
          
          {% if section.settings.enable_cta %}
            <button id="cta_button_{{ product.id }}" class="product-info-btn"
              onclick="openPopup('{{ product.id }}')">+</button>
          {% endif %}
        </div>
        <h3>{{ product.title }}</h3>
        <p>{{ product.price | money }}</p>
      </div>

      <div id="popup-{{ product.id }}" class="product-popup">
        <div class="popup-content">
          <span class="close-btn" onclick="closePopup('{{ product.id }}')">&times;</span>
          <img src="{{ product.featured_image | img_url: '500x500' }}" alt="{{ product.title }}">
          <h2>{{ product.title }}</h2>
          <p>{{ product.description }}</p>
          <p><strong>Price:</strong> {{ product.price | money }}</p>
          <a href="{{ product.url }}" class="buy-now">Buy Now</a>
        </div>
      </div>
    {% endfor %}
  </div>

  <style>
    .featured-collection {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }

    .product-card {
      position: relative;
      width: 250px;
      text-align: center;
    }

    .product-image-container {
      position: relative;
      display: inline-block;
    }

    .product-info-btn {
      position: absolute;
      background: white;
      border: 2px solid black;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transform: translate(-50%, -50%);
    }

    .product-popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }

    .popup-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      position: relative;
      text-align: center;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 20px;
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll(".product-card").forEach(card => {
        let img = card.querySelector("img");
        let button = card.querySelector(".product-info-btn");

        if (img && button) {
          let focalX = img.getAttribute("data-focal-x") || "50"; // Default center
          let focalY = img.getAttribute("data-focal-y") || "50"; // Default center
          
          button.style.left = focalX + "%";
          button.style.top = focalY + "%";
        }
      });
    });

    function openPopup(productId) {
      document.getElementById('popup-' + productId).style.display = 'flex';
    }
    function closePopup(productId) {
      document.getElementById('popup-' + productId).style.display = 'none';
    }
  </script>
{% else %}
  <p>No products found in this collection.</p>
{% endif %}
{% comment %} {%- if section.settings.title != blank -%}
  <h2>
    {{ section.settings.title }}
  </h2>
{%- endif -%}

<ul>
        {%- if section.settings.collection.products.size > 0 -%}
            {%- for product in section.settings.collection.products limit: section.settings.products_to_show -%}
              <li>
                {% render 'card-product',
                  card_product: product,
                  image_shape: section.settings.image_shape,
                  media_aspect_ratio: section.settings.image_ratio,
                  show_vendor: section.settings.show_vendor,
                  section_id: section.id,
                  quick_add: section.settings.quick_add
                %}
              </li>
            {%- endfor -%}
        {%- endif -%}
      </ul> {% endcomment %}
{% comment %}

{% schema %}
  {
    "name": "Products Show",
    "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "Select Collection"
    },
    {
      "type": "checkbox",
      "id": "enable_cta",
      "label": "Enable CTA Buttons",
      "default": true
    }
  ],
    "presets": [
      {
        "name": "Products Show",
        "category": "Products"
      }
    ]
  }
{% endschema %}
{% schema %}
  {
    "name": "Products Show",
    "settings": [
      {
      "type": "inline_richtext",
      "id": "title",
      "label": "Product Show Title"
      },
      {
      "type": "collection",
      "id": "collection",
      "label": "Collections"
      },
      {
        "type": "select",
        "id": "image_ratio",
        "options": [
          {
            "value": "adapt",
            "label": "t:sections.featured-collection.settings.image_ratio.options__1.label"
          },
          {
            "value": "portrait",
            "label": "t:sections.featured-collection.settings.image_ratio.options__2.label"
          },
          {
            "value": "square",
            "label": "t:sections.featured-collection.settings.image_ratio.options__3.label"
          }
        ],
        "default": "adapt",
        "label": "t:sections.featured-collection.settings.image_ratio.label"
      }
    ],
    "presets": [
      {
        "name": "Products Show"
      }
    ]
  }
{% endschema %}
{% endcomment %}