{% schema %}
{
    "name": "Product Hotspots",
    "settings": [],
    "blocks": [
        {
            "type": "hotspot",
            "name": "Hotspot",
            "settings": [
                {
                    "type": "product",
                    "id": "product",
                    "label": "Select Product"
                },
                {
                    "type": "range",
                    "id": "top",
                    "label": "Position from Top",
                    "min": 0,
                    "max": 100,
                    "step": 1,
                    "unit": "%",
                    "default": 50
                },
                {
                    "type": "range",
                    "id": "left",
                    "label": "Position from Left",
                    "min": 0,
                    "max": 100,
                    "step": 1,
                    "unit": "%",
                    "default": 50
                }
            ]
        }
    ],
    "presets": [
        {
            "name": "Product Hotspots",
            "blocks": [
                { "type": "hotspot" }
            ]
        }
    ]
}
{% endschema %}

<div class="hotspot-container">
    {% assign first_product = section.blocks[0].settings.product %}

    {% if first_product != blank %}
        <img src="{{ first_product.featured_image | img_url: '1024x1024' }}" 
             alt="{{ first_product.title }}" 
             class="product-image">
    {% else %}
        <p>Please add a product hotspot.</p>
    {% endif %}

    {% for block in section.blocks %}
        {% if block.settings.product != blank %}
            <div class="hotspot" 
                 style="top: {{ block.settings.top }}%; left: {{ block.settings.left }}%;" 
                 data-title="{{ block.settings.product.title }}"
                 data-price="{{ block.settings.product.price | money }}"
                 data-url="{{ block.settings.product.url }}"
                 data-image="{{ block.settings.product.featured_image | img_url: '150x150' }}">
                <span>+</span>
            </div>
        {% endif %}
    {% endfor %}
</div>

<!-- Popup Modal for Product Info -->
<div id="product-popup" class="popup">
    <div class="popup-content">
        <span class="close-popup">&times;</span>
        <img id="popup-image" src="" alt="Product Image">
        <h3 id="popup-title"></h3>
        <p id="popup-price"></p>
        <a id="popup-link" href="#" target="_blank">View Product</a>
    </div>
</div>

<style>
/* Container */
.hotspot-container {
    position: relative;
    display: inline-block;
    width: 100%;
    max-width: 600px;
    margin: auto;
}

/* Product Image */
.product-image {
    width: 100%;
    height: auto;
    display: block;
}

/* Hotspot Styling */
.hotspot {
    position: absolute;
    width: 25px;
    height: 25px;
    background-color: red;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    cursor: pointer;
    transition: transform 0.3s ease-in-out;
}

.hotspot:hover {
    transform: scale(1.2);
}

/* Popup Modal */
.popup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    z-index: 1000;
    text-align: center;
}

.popup-content {
    max-width: 300px;
}

.popup img {
    max-width: 100px;
    margin-bottom: 10px;
}

.popup h3 {
    margin: 0;
    font-size: 18px;
}

.popup p {
    font-size: 16px;
    color: #333;
}

.popup a {
    display: inline-block;
    margin-top: 10px;
    padding: 8px 12px;
    background-color: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 5px;
}

.popup a:hover {
    background-color: #0056b3;
}

.close-popup {
    position: absolute;
    top: 5px;
    right: 10px;
    font-size: 20px;
    cursor: pointer;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const hotspots = document.querySelectorAll(".hotspot");
    const popup = document.getElementById("product-popup");
    const popupTitle = document.getElementById("popup-title");
    const popupPrice = document.getElementById("popup-price");
    const popupImage = document.getElementById("popup-image");
    const popupLink = document.getElementById("popup-link");
    const closePopup = document.querySelector(".close-popup");

    hotspots.forEach(hotspot => {
        hotspot.addEventListener("click", function () {
            popupTitle.innerText = this.getAttribute("data-title");
            popupPrice.innerText = this.getAttribute("data-price");
            popupImage.src = this.getAttribute("data-image");
            popupLink.href = this.getAttribute("data-url");

            popup.style.display = "block";
        });
    });

    closePopup.addEventListener("click", function () {
        popup.style.display = "none";
    });

    window.addEventListener("click", function (event) {
        if (event.target === popup) {
            popup.style.display = "none";
        }
    });
});
</script>